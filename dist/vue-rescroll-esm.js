var o=function(){this.position={x:0,y:0}};o.prototype.$savePosition=function(o){return Object.assign(this.position,o)};var t=function(o){this.vnode={},this.opt=o,this.timer={},this.openScrollStore(),this.getPosition(),this.scrollTo()};t.prototype.update=function(){return this.scrollTo(),this},t.prototype.openScrollStore=function(){var t=this.opt,e=t.rescroll;void 0===e&&(e=null);var r=t.name,i=t.storageMode;return void 0===i&&(i=""),e&&"localstorage"!==i?(e[r]||(e[r]=new o),this):this},t.prototype.getPosition=function(){var o,t=this,r=this.opt,i=r.dom,l=r.name,s=r.rescroll,n=r.type,c=r.storageMode;return o=n&&"window"===n?window:i,this.watchScroll=function(){if(l===e){var o="timer-"+l;clearTimeout(t.timer[o]),t.timer[o]=setTimeout(function(){var e;e=n&&"window"===n?{x:window.scrollX,y:window.scrollY}:{x:i.scrollLeft,y:i.scrollTop},c&&"localstorage"===c?localStorage.setItem(""+l,JSON.stringify(e)):s[l].$savePosition(e),delete t.timer[o]},1e3/60)}},o.addEventListener("scroll",this.watchScroll,!1),this},t.prototype.scrollTo=function(){var o,t=this,e=this.opt,r=e.dom,i=e.name,l=e.rescroll,s=e.type,n=e.storageMode,c=e.vnode;if(n&&"localstorage"===n){var a=localStorage.getItem(""+i);if(!a)return this;o=JSON.parse(a)}else o=l[i].position;if(!o)return this;var d=o.x;void 0===d&&(d=0);var u=o.y;return void 0===u&&(u=0),c.context?(c.context.$nextTick(function(){if(s&&"window"===s)window.scrollTo(d,u);else{if(!l[i]||r.scrollHeight<u||r.scrollWidth<d)return r.scrollLeft=0,r.scrollTop=0,t;r.scrollLeft=d,r.scrollTop=u}}),this):this},t.prototype.destroy=function(){var o=this.opt.dom;return this.watchScroll&&o.removeEventListener("scroll",this.watchScroll,!1),this};var e="",r=function(o,r,i){if(!r.value)throw Error("please set required parameters");if(e=r.value.name,!i.context)throw Error("it is not a vnode");if(i.context.$root){var l,s=i.context.$root,n=r.value,c=n.name,a=n.type;void 0===a&&(a="");var d=n.storageMode;void 0===d&&(d="");var u=n.domType;if(void 0===u&&(u=""),!c)throw Error("please set name");return"localstorage"===r.value.storageMode?l={dom:o,name:c,type:a,storageMode:d,vnode:i}:(s.$rescroll||(s.$rescroll={}),l={dom:o,name:c,type:a,storageMode:d,vnode:i,rescroll:s.$rescroll}),o.restoreScroll||(o.restoreScroll={}),o.restoreScroll[e]?void(u&&"tab"===u&&o.restoreScroll[e].update(l)):void(o.restoreScroll[e]=new t(l))}},i={inserted:function(o,t,e){return r(o,t,e)},componentUpdated:function(o,t,e){return r(o,t,e)},unbind:function(o){o.restoreScroll&&o.restoreScroll[e]&&(o.restoreScroll[e].destroy(),delete o.restoreScroll)}},l={install:function(o){o.directive("rescroll",i)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(l);export default l;export{i as directive};
