"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ScrollPosition=function(){this.position={x:0,y:0}};ScrollPosition.prototype.$savePosition=function(o){return Object.assign(this.position,o)};var RestoreScroll=function(o){this.vnode={},this.opt=o,this.timer={},this.openScrollStore(),this.getPosition(),this.scrollTo()};RestoreScroll.prototype.update=function(){return this.scrollTo(),this},RestoreScroll.prototype.openScrollStore=function(){var o=this.opt,e=o.rescroll;void 0===e&&(e=null);var t=o.name,r=o.storageMode;return void 0===r&&(r=""),e&&"localstorage"!==r?(e[t]||(e[t]=new ScrollPosition),this):this},RestoreScroll.prototype.getPosition=function(){var o,e=this,t=this.opt,r=t.dom,l=t.name,i=t.rescroll,n=t.type,s=t.storageMode;return o=n&&"window"===n?window:r,this.watchScroll=function(){if(l===nowName){var o="timer-"+l;clearTimeout(e.timer[o]),e.timer[o]=setTimeout(function(){var t;t=n&&"window"===n?{x:window.scrollX,y:window.scrollY}:{x:r.scrollLeft,y:r.scrollTop},s&&"localstorage"===s?localStorage.setItem(""+l,JSON.stringify(t)):i[l].$savePosition(t),delete e.timer[o]},1e3/60)}},o.addEventListener("scroll",this.watchScroll,!1),this},RestoreScroll.prototype.scrollTo=function(){var o,e=this,t=this.opt,r=t.dom,l=t.name,i=t.rescroll,n=t.type,s=t.storageMode,c=t.vnode;if(s&&"localstorage"===s){var a=localStorage.getItem(""+l);if(!a)return this;o=JSON.parse(a)}else o=i[l].position;if(!o)return this;var d=o.x;void 0===d&&(d=0);var u=o.y;return void 0===u&&(u=0),c.context?(c.context.$nextTick(function(){if(n&&"window"===n)window.scrollTo(d,u);else{if(!i[l]||r.scrollHeight<u||r.scrollWidth<d)return r.scrollLeft=0,r.scrollTop=0,e;r.scrollLeft=d,r.scrollTop=u}}),this):this},RestoreScroll.prototype.destroy=function(){var o=this.opt.dom;return this.watchScroll&&o.removeEventListener("scroll",this.watchScroll,!1),this};var nowName="",fun=function(o,e,t){if(!e.value)throw Error("please set required parameters");if(nowName=e.value.name,!t.context)throw Error("it is not a vnode");if(t.context.$root){var r,l=t.context.$root,i=e.value,n=i.name,s=i.type;void 0===s&&(s="");var c=i.storageMode;void 0===c&&(c="");var a=i.domType;if(void 0===a&&(a=""),!n)throw Error("please set name");return"localstorage"===e.value.storageMode?r={dom:o,name:n,type:s,storageMode:c,vnode:t}:(l.$rescroll||(l.$rescroll={}),r={dom:o,name:n,type:s,storageMode:c,vnode:t,rescroll:l.$rescroll}),o.restoreScroll||(o.restoreScroll={}),o.restoreScroll[nowName]?void(a&&"tab"===a&&o.restoreScroll[nowName].update(r)):void(o.restoreScroll[nowName]=new RestoreScroll(r))}},directive={inserted:function(o,e,t){return fun(o,e,t)},componentUpdated:function(o,e,t){return fun(o,e,t)},unbind:function(o){o.restoreScroll&&o.restoreScroll[nowName]&&(o.restoreScroll[nowName].destroy(),delete o.restoreScroll)}},plugin={install:function(o){o.directive("rescroll",directive)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(plugin),exports.default=plugin,exports.directive=directive;
