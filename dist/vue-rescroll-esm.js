var o=function(){this.position={x:0,y:0}};o.prototype.$savePosition=function(o){return Object.assign(this.position,o)};var e=function(o){this.vnode={},this.opt=o,this.timer={},this.openScrollStore(),this.getPosition(),this.scrollTo()};e.prototype.update=function(){return this.scrollTo(),this},e.prototype.openScrollStore=function(){var e=this.opt,t=e.rescroll;void 0===t&&(t=null);var r=e.name,i=e.storageMode;return void 0===i&&(i=""),t&&"localstorage"!==i?(t[r]||(t[r]=new o),this):this},e.prototype.getPosition=function(){var o,e=this,r=this.opt,i=r.dom,l=r.name,s=r.rescroll,n=r.type,c=r.storageMode,a=r.key;return o=n&&"window"===n?window:i,this.watchScroll=function(){if(l===t){var o="timer-"+l;clearTimeout(e.timer[o]),e.timer[o]=setTimeout(function(){var o;o=n&&"window"===n?{x:window.scrollX,y:window.scrollY}:{x:i.scrollLeft,y:i.scrollTop},c&&"localstorage"===c?localStorage.setItem(""+a,JSON.stringify(o)):s[l].$savePosition(o),delete e.timer[a]},1e3/60)}},o.addEventListener("scroll",this.watchScroll,!1),this},e.prototype.scrollTo=function(){var o,e=this,t=this.opt,r=t.dom,i=t.name,l=t.rescroll,s=t.type,n=t.storageMode,c=t.key,a=t.vnode;if(n&&"localstorage"===n){var d=localStorage.getItem(""+c);if(!d)return this;o=JSON.parse(d)}else o=l[i].position;if(!o)return this;var u=o.x;void 0===u&&(u=0);var p=o.y;return void 0===p&&(p=0),a.context?(a.context.$nextTick(function(){if(s&&"window"===s)window.scrollTo(u,p);else{if(!l[i]||r.scrollHeight<p||r.scrollWidth<u)return r.scrollLeft=0,r.scrollTop=0,e;r.scrollLeft=u,r.scrollTop=p}}),this):this},e.prototype.destroy=function(){var o=this.opt.dom;return this.watchScroll&&o.removeEventListener("scroll",this.watchScroll,!1),this};var t="",r=function(o,r,i){if(!r.value)throw Error("please set required parameters");if(t=r.value.name,!i.context)throw Error("it is not a vnode");if(i.context.$root){var l,s=i.context.$root,n=r.value,c=n.name,a=n.type;void 0===a&&(a="");var d=n.storageMode;void 0===d&&(d="");var u=n.key;void 0===u&&(u="");var p=n.domType;if(void 0===p&&(p=""),!c)throw Error("please set name");return"localstorage"===r.value.storageMode?l={dom:o,name:c,type:a,storageMode:d,key:u,vnode:i}:(s.$rescroll||(s.$rescroll={}),l={dom:o,name:c,type:a,storageMode:d,key:u,vnode:i,rescroll:s.$rescroll}),o.restoreScroll||(o.restoreScroll={}),o.restoreScroll[t]?void(p&&"tab"===p&&o.restoreScroll[t].update(l)):void(o.restoreScroll[t]=new e(l))}},i={inserted:function(o,e,t){return r(o,e,t)},componentUpdated:function(o,e,t){return r(o,e,t)},unbind:function(o){o.restoreScroll&&o.restoreScroll[t]&&(o.restoreScroll[t].destroy(),delete o.restoreScroll)}},l={install:function(o){o.directive("rescroll",i)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(l);export default l;export{i as directive};
