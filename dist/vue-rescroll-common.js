"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ScrollPosition=function(){this.position={x:0,y:0}};ScrollPosition.prototype.$savePosition=function(o){return Object.assign(this.position,o)};var RestoreScroll=function(o){this.vnode={},this.opt=o,this.timer={},this.openScrollStore(),this.getPosition(),this.scrollTo()};RestoreScroll.prototype.update=function(){return this.scrollTo(),this},RestoreScroll.prototype.openScrollStore=function(){var o=this.opt,e=o.rescroll;void 0===e&&(e=null);var t=o.name,r=o.storageMode;return void 0===r&&(r=""),e&&"localstorage"!==r?(e[t]||(e[t]=new ScrollPosition),this):this},RestoreScroll.prototype.getPosition=function(){var o,e=this,t=this.opt,r=t.dom,i=t.name,l=t.rescroll,n=t.type,s=t.storageMode,c=t.key;return o=n&&"window"===n?window:r,this.watchScroll=function(){if(i===nowName){var o="timer-"+i;clearTimeout(e.timer[o]),e.timer[o]=setTimeout(function(){var o;o=n&&"window"===n?{x:window.scrollX,y:window.scrollY}:{x:r.scrollLeft,y:r.scrollTop},s&&"localstorage"===s?localStorage.setItem(""+c,JSON.stringify(o)):l[i].$savePosition(o),delete e.timer[c]},1e3/60)}},o.addEventListener("scroll",this.watchScroll,!1),this},RestoreScroll.prototype.scrollTo=function(){var o,e=this,t=this.opt,r=t.dom,i=t.name,l=t.rescroll,n=t.type,s=t.storageMode,c=t.key,a=t.vnode;if(s&&"localstorage"===s){var d=localStorage.getItem(""+c);if(!d)return this;o=JSON.parse(d)}else o=l[i].position;if(!o)return this;var u=o.x;void 0===u&&(u=0);var p=o.y;return void 0===p&&(p=0),a.context?(a.context.$nextTick(function(){if(n&&"window"===n)window.scrollTo(u,p);else{if(!l[i]||r.scrollHeight<p||r.scrollWidth<u)return r.scrollLeft=0,r.scrollTop=0,e;r.scrollLeft=u,r.scrollTop=p}}),this):this},RestoreScroll.prototype.destroy=function(){var o=this.opt.dom;return this.watchScroll&&o.removeEventListener("scroll",this.watchScroll,!1),this};var nowName="",fun=function(o,e,t){if(!e.value)throw Error("please set required parameters");if(nowName=e.value.name,!t.context)throw Error("it is not a vnode");if(t.context.$root){var r,i=t.context.$root,l=e.value,n=l.name,s=l.type;void 0===s&&(s="");var c=l.storageMode;void 0===c&&(c="");var a=l.key;void 0===a&&(a="");var d=l.domType;if(void 0===d&&(d=""),!n)throw Error("please set name");return"localstorage"===e.value.storageMode?r={dom:o,name:n,type:s,storageMode:c,key:a,vnode:t}:(i.$rescroll||(i.$rescroll={}),r={dom:o,name:n,type:s,storageMode:c,key:a,vnode:t,rescroll:i.$rescroll}),o.restoreScroll||(o.restoreScroll={}),o.restoreScroll[nowName]?void(d&&"tab"===d&&o.restoreScroll[nowName].update(r)):void(o.restoreScroll[nowName]=new RestoreScroll(r))}},directive={inserted:function(o,e,t){return fun(o,e,t)},componentUpdated:function(o,e,t){return fun(o,e,t)},unbind:function(o){o.restoreScroll&&o.restoreScroll[nowName]&&(o.restoreScroll[nowName].destroy(),delete o.restoreScroll)}},plugin={install:function(o){o.directive("rescroll",directive)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(plugin),exports.default=plugin,exports.directive=directive;
